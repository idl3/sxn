#!/usr/bin/env bash
#
# Setup git hooks for sxn development
#

set -e

echo "ðŸ”§ Setting up git hooks for sxn development..."

# Create hooks directory if it doesn't exist
mkdir -p .git/hooks

# Create pre-push hook
cat > .git/hooks/pre-push << 'EOF'
#!/bin/sh
#
# Pre-push hook for sxn project
# Runs RuboCop and RSpec before allowing push
#

echo "ðŸ” Running pre-push checks..."

# Run RuboCop
echo "ðŸ“ Checking code style with RuboCop..."
bundle exec rubocop
if [ $? -ne 0 ]; then
    echo "âŒ RuboCop failed! Please fix linting issues before pushing."
    echo "   Run: bundle exec rubocop -a"
    exit 1
fi

# Run RSpec tests
echo "ðŸ§ª Running tests with RSpec..."
bundle exec rspec --format progress
if [ $? -ne 0 ]; then
    echo "âŒ Tests failed! Please fix failing tests before pushing."
    exit 1
fi

echo "âœ… All checks passed! Proceeding with push..."
exit 0
EOF

chmod +x .git/hooks/pre-push

echo "âœ… Git hooks installed successfully!"
echo ""
echo "The following hooks have been set up:"
echo "  â€¢ pre-push: Runs RuboCop and RSpec before pushing"
echo ""
echo "To bypass hooks in emergency (not recommended):"
echo "  git push --no-verify"